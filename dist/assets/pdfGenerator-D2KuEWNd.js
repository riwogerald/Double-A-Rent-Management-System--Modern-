import{f as p,E as m}from"./index-Xfq9hEUY.js";import y from"./html2canvas.esm-BfxBtG_O.js";class f{pdf;pageHeight;pageWidth;margin=20;currentY=20;constructor(){this.pdf=new m,this.pageHeight=this.pdf.internal.pageSize.getHeight(),this.pageWidth=this.pdf.internal.pageSize.getWidth()}checkPageBreak(e){this.currentY+e>this.pageHeight-this.margin&&(this.pdf.addPage(),this.currentY=this.margin)}addHeader(e,n){this.pdf.setFillColor(37,99,235),this.pdf.rect(this.margin,10,30,15,"F"),this.pdf.setTextColor(255,255,255),this.pdf.setFontSize(12),this.pdf.setFont("helvetica","bold"),this.pdf.text("DA",this.margin+12,20),this.pdf.setTextColor(0,0,0),this.pdf.setFontSize(10),this.pdf.setFont("helvetica","normal"),this.pdf.text("Double A Rent Management System",this.margin+35,15),this.pdf.text(`Generated: ${p(new Date,"PPP p")}`,this.margin+35,22),this.pdf.setFontSize(20),this.pdf.setFont("helvetica","bold"),this.pdf.setTextColor(37,99,235),this.pdf.text(e,this.margin,40),n?(this.pdf.setFontSize(12),this.pdf.setFont("helvetica","normal"),this.pdf.setTextColor(100,100,100),this.pdf.text(n,this.margin,50),this.currentY=60):this.currentY=50,this.pdf.setDrawColor(200,200,200),this.pdf.line(this.margin,this.currentY,this.pageWidth-this.margin,this.currentY),this.currentY+=10}addSummaryCards(e){this.checkPageBreak(40),this.pdf.setFontSize(14),this.pdf.setFont("helvetica","bold"),this.pdf.setTextColor(0,0,0),this.pdf.text("Executive Summary",this.margin,this.currentY),this.currentY+=15;const n=Object.entries(e),i=(this.pageWidth-2*this.margin-10)/2,s=25;n.forEach((r,l)=>{const[h,d]=r,c=l%2,o=Math.floor(l/2);c===0&&this.checkPageBreak(s+5);const a=this.margin+c*(i+10),g=this.currentY+o*(s+5);this.pdf.setFillColor(248,250,252),this.pdf.setDrawColor(226,232,240),this.pdf.rect(a,g,i,s,"FD"),this.pdf.setFontSize(10),this.pdf.setFont("helvetica","normal"),this.pdf.setTextColor(100,116,139),this.pdf.text(h,a+5,g+8),this.pdf.setFontSize(16),this.pdf.setFont("helvetica","bold"),this.pdf.setTextColor(0,0,0),this.pdf.text(String(d),a+5,g+18),(c===1||l===n.length-1)&&(this.currentY=g+s+10)})}addTable(e,n){if(e.length===0)return;this.checkPageBreak(50);const i=this.pageWidth-2*this.margin,s=i/n.length,r=8;this.pdf.setFillColor(37,99,235),this.pdf.rect(this.margin,this.currentY,i,r,"F"),this.pdf.setFontSize(9),this.pdf.setFont("helvetica","bold"),this.pdf.setTextColor(255,255,255),n.forEach((l,h)=>{const d=this.margin+h*s+3;this.pdf.text(l.label,d,this.currentY+5)}),this.currentY+=r,this.pdf.setFont("helvetica","normal"),this.pdf.setTextColor(0,0,0),e.forEach((l,h)=>{this.checkPageBreak(r),h%2===0&&(this.pdf.setFillColor(248,250,252),this.pdf.rect(this.margin,this.currentY,i,r,"F")),n.forEach((d,c)=>{const o=this.margin+c*s+3;let a=l[d.key]||"";d.format&&a&&(a=d.format(a));const g=s-6,u=this.pdf.splitTextToSize(String(a),g);this.pdf.text(u[0]||"",o,this.currentY+5)}),this.currentY+=r}),this.currentY+=5}async addChart(e){this.checkPageBreak(100);try{const n=await y(e,{scale:2,backgroundColor:"#ffffff",logging:!1,useCORS:!0}),i=n.toDataURL("image/png"),s=this.pageWidth-2*this.margin,r=n.height*s/n.width;this.checkPageBreak(r),this.pdf.addImage(i,"PNG",this.margin,this.currentY,s,r),this.currentY+=r+10}catch(n){console.error("Error adding chart to PDF:",n),this.pdf.setFontSize(10),this.pdf.setTextColor(150,150,150),this.pdf.text("Chart could not be generated",this.margin,this.currentY),this.currentY+=20}}addInsights(e){e.length!==0&&(this.checkPageBreak(30),this.pdf.setFontSize(14),this.pdf.setFont("helvetica","bold"),this.pdf.setTextColor(0,0,0),this.pdf.text("Key Insights",this.margin,this.currentY),this.currentY+=15,e.forEach((n,i)=>{this.checkPageBreak(15),this.pdf.setFontSize(10),this.pdf.setFont("helvetica","normal"),this.pdf.setTextColor(60,60,60);const s=`${i+1}. `,r=this.pageWidth-2*this.margin-10,l=this.pdf.splitTextToSize(n,r);this.pdf.text(s,this.margin,this.currentY),this.pdf.text(l,this.margin+10,this.currentY),this.currentY+=l.length*5+3}))}addFooter(){let e=1;try{typeof this.pdf.getNumberOfPages=="function"?e=this.pdf.getNumberOfPages():this.pdf.internal&&typeof this.pdf.internal.getNumberOfPages=="function"?e=this.pdf.internal.getNumberOfPages():e=Math.max(1,Math.ceil(this.currentY/this.pageHeight))}catch(n){console.warn("Could not determine page count, defaulting to 1:",n),e=1}for(let n=1;n<=e;n++)try{this.pdf.setPage(n),this.pdf.setDrawColor(200,200,200),this.pdf.line(this.margin,this.pageHeight-15,this.pageWidth-this.margin,this.pageHeight-15),this.pdf.setFontSize(8),this.pdf.setFont("helvetica","normal"),this.pdf.setTextColor(100,100,100),this.pdf.text(`Page ${n} of ${e}`,this.pageWidth-this.margin-20,this.pageHeight-8),this.pdf.text("Double A Rent Management System",this.margin,this.pageHeight-8)}catch(i){console.warn(`Could not add footer to page ${n}:`,i)}}async generateReport(e){this.addHeader(e.title,e.subtitle),e.summary&&this.addSummaryCards(e.summary),e.chartElement&&await this.addChart(e.chartElement),e.insights&&e.insights.length>0&&this.addInsights(e.insights),e.data.length>0&&(this.checkPageBreak(30),this.pdf.setFontSize(14),this.pdf.setFont("helvetica","bold"),this.pdf.setTextColor(0,0,0),this.pdf.text("Detailed Data",this.margin,this.currentY),this.currentY+=15,this.addTable(e.data,e.columns)),this.addFooter()}save(e){this.pdf.save(e)}getBlob(){return this.pdf.output("blob")}getDataUrl(){return this.pdf.output("dataurlstring")}}const S=async(t,e,n)=>{const i=new f,s=t.reduce((o,a)=>o+(a.amountPaid||0),0),r=t.reduce((o,a)=>o+(a.rentAmount||0),0),l=r>0?s/r*100:0,h=r-s,d=[{key:"tenant",label:"Tenant"},{key:"property",label:"Property"},{key:"rentAmount",label:"Expected",format:o=>`$${o.toLocaleString()}`},{key:"amountPaid",label:"Paid",format:o=>`$${o.toLocaleString()}`},{key:"status",label:"Status"},{key:"paymentDate",label:"Payment Date"}],c=[`Collection rate of ${l.toFixed(1)}% ${l>=90?"exceeds":l>=80?"meets":"falls below"} industry standards`,`Outstanding amount of $${h.toLocaleString()} requires ${h>5e4?"immediate":"routine"} follow-up`,`${t.filter(o=>o.status==="Paid").length} out of ${t.length} tenants have paid in full`,s>0?`Average payment amount is $${(s/t.filter(o=>o.amountPaid>0).length||0).toLocaleString()}`:"No payments recorded in this period"];await i.generateReport({title:"Rent Collection Report",subtitle:n?`Period: ${n.start} to ${n.end}`:`Generated on ${p(new Date,"PPP")}`,data:t,columns:d,summary:{"Total Expected":`$${r.toLocaleString()}`,"Total Collected":`$${s.toLocaleString()}`,"Collection Rate":`${l.toFixed(1)}%`,Outstanding:`$${h.toLocaleString()}`,Properties:t.length.toString(),"Paid in Full":t.filter(o=>o.status==="Paid").length.toString()},chartElement:e,insights:c}),i.save(`rent-collection-report-${p(new Date,"yyyy-MM-dd")}.pdf`)},v=async(t,e,n)=>{const i=new f,s=t.reduce((a,g)=>a+(g.commissionEarned||0),0),r=t.reduce((a,g)=>a+(g.totalRentCollected||0),0),l=t.reduce((a,g)=>a+(g.properties||0),0),h=t.length>0?s/t.length:0,d=[{key:"agent",label:"Agent Name"},{key:"properties",label:"Properties"},{key:"totalRentCollected",label:"Rent Collected",format:a=>`$${a.toLocaleString()}`},{key:"commissionRate",label:"Rate",format:a=>`${a}%`},{key:"commissionEarned",label:"Commission",format:a=>`$${a.toLocaleString()}`}],c=t.sort((a,g)=>g.commissionEarned-a.commissionEarned)[0],o=[`${t.length} agents managed a total of ${l} properties`,`Total commissions paid: $${s.toLocaleString()}`,c?`Top performer: ${c.agent} earned $${c.commissionEarned.toLocaleString()}`:"No commission data available",`Average commission per agent: $${h.toLocaleString()}`,r>0?`Commission rate averages ${(s/r*100).toFixed(2)}% of rent collected`:"No rent collection data available"];await i.generateReport({title:"Agent Earnings Report",subtitle:n?`Period: ${n.start} to ${n.end}`:`Generated on ${p(new Date,"PPP")}`,data:t,columns:d,summary:{"Total Agents":t.length.toString(),"Total Properties":l.toString(),"Total Commissions":`$${s.toLocaleString()}`,"Avg Commission":`$${h.toLocaleString()}`,"Rent Collected":`$${r.toLocaleString()}`,"Commission Rate":`${r>0?(s/r*100).toFixed(2):0}%`},chartElement:e,insights:o}),i.save(`agent-earnings-report-${p(new Date,"yyyy-MM-dd")}.pdf`)},x=async(t,e)=>{const n=new f,i=t.reduce((c,o)=>c+(o.outstandingAmount||0),0),s=t.length>0?i/t.length:0,r=t.filter(c=>c.daysOverdue>60).length,l=t.filter(c=>c.daysOverdue<=30).length,h=[{key:"tenant",label:"Tenant Name"},{key:"property",label:"Property"},{key:"rentAmount",label:"Monthly Rent",format:c=>`$${c.toLocaleString()}`},{key:"lastPayment",label:"Last Payment"},{key:"outstandingAmount",label:"Outstanding",format:c=>`$${c.toLocaleString()}`},{key:"daysOverdue",label:"Days Overdue"}],d=[`${t.length} tenants have outstanding payments totaling $${i.toLocaleString()}`,`${r} cases are critical (over 60 days overdue) requiring immediate action`,`${l} cases are recent (under 30 days) and may resolve with standard follow-up`,`Average outstanding amount per tenant: $${s.toLocaleString()}`,t.length>0?`Longest overdue period: ${Math.max(...t.map(c=>c.daysOverdue))} days`:"No overdue cases found"];await n.generateReport({title:"Defaulters Report",subtitle:`Outstanding Payments as of ${p(new Date,"PPP")}`,data:t,columns:h,summary:{"Total Defaulters":t.length.toString(),"Total Outstanding":`$${i.toLocaleString()}`,"Average Outstanding":`$${s.toLocaleString()}`,"Critical Cases":r.toString(),"Recent Cases":l.toString(),"Collection Priority":r>0?"High":l>0?"Medium":"Low"},chartElement:e,insights:d}),n.save(`defaulters-report-${p(new Date,"yyyy-MM-dd")}.pdf`)},b=async(t,e)=>{const n=new f,i=t.length,s=t.filter(o=>o.status==="Occupied").length,r=t.filter(o=>o.status==="Vacant").length,l=t.reduce((o,a)=>o+(a.rent_amount||0),0),h=i>0?s/i*100:0,d=[{key:"property_no",label:"Property #"},{key:"estate_name",label:"Estate"},{key:"house_number",label:"Unit"},{key:"house_type",label:"Type"},{key:"rent_amount",label:"Monthly Rent",format:o=>`$${o.toLocaleString()}`},{key:"status",label:"Status"},{key:"tenant_name",label:"Tenant"}],c=[`Portfolio consists of ${i} properties with ${h.toFixed(1)}% occupancy rate`,`${r} vacant properties represent potential monthly revenue of $${t.filter(o=>o.status==="Vacant").reduce((o,a)=>o+(a.rent_amount||0),0).toLocaleString()}`,`Total monthly rent value: $${l.toLocaleString()}`,h>=95?"Excellent occupancy rate indicates strong demand":h>=85?"Good occupancy rate with room for improvement":"Low occupancy rate requires marketing attention",`Average rent per property: $${i>0?(l/i).toLocaleString():0}`];await n.generateReport({title:"Property Portfolio Report",subtitle:`Portfolio Analysis as of ${p(new Date,"PPP")}`,data:t,columns:d,summary:{"Total Properties":i.toString(),Occupied:s.toString(),Vacant:r.toString(),"Occupancy Rate":`${h.toFixed(1)}%`,"Monthly Rent Value":`$${l.toLocaleString()}`,"Avg Rent/Property":`$${i>0?Math.round(l/i).toLocaleString():0}`},chartElement:e,insights:c}),n.save(`property-portfolio-report-${p(new Date,"yyyy-MM-dd")}.pdf`)},C=async(t,e)=>{const n=new f,i=[`Collection rate of ${t.collectionRate.toFixed(1)}% ${t.collectionRate>=90?"exceeds industry benchmarks":"requires improvement"}`,`Occupancy rate of ${t.occupancyRate.toFixed(1)}% ${t.occupancyRate>=95?"indicates excellent property management":"shows potential for growth"}`,`Outstanding amount of $${t.outstandingAmount.toLocaleString()} represents ${(t.outstandingAmount/t.totalExpected*100).toFixed(1)}% of expected revenue`,t.totalRevenue>t.totalExpected*.9?"Strong financial performance this period":"Revenue collection needs attention",`${t.vacantProperties} vacant properties could generate additional $${(t.totalRevenue/t.occupiedProperties*t.vacantProperties||0).toLocaleString()} monthly`];await n.generateReport({title:"Financial Summary Report",subtitle:`Comprehensive Financial Analysis - ${p(new Date,"MMMM yyyy")}`,data:[],columns:[],summary:{"Total Revenue":`$${t.totalRevenue.toLocaleString()}`,"Expected Revenue":`$${t.totalExpected.toLocaleString()}`,"Collection Rate":`${t.collectionRate.toFixed(1)}%`,"Outstanding Amount":`$${t.outstandingAmount.toLocaleString()}`,"Total Properties":t.totalProperties.toString(),"Occupancy Rate":`${t.occupancyRate.toFixed(1)}%`},chartElement:e?.revenue,insights:i}),n.save(`financial-summary-report-${p(new Date,"yyyy-MM-dd")}.pdf`)};export{f as PDFGenerator,v as generateAgentEarningsReport,x as generateDefaultersReport,C as generateFinancialSummaryReport,b as generatePropertyReport,S as generateRentCollectionReport};
